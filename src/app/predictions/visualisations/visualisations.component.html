<!-- FILTERS -->
<section class="bleu">
  <h2>{{ l.t['FILTRE_TITRE'] }}</h2>
  <button (click)="infos = !infos" class="annule"><i class="pi pi-info-circle"></i>{{ l.t['COMMENT'] }}</button>
  <form [formGroup]="fF" class="bleu">
    <div>
      <h3>{{ l.t['FILTRE_PAYS'] }}</h3>
      <p-listbox [options]="store.listes.pays" formControlName="pays" (onChange)="filtrePays($event)" [multiple]="true"
        [checkbox]="true" [filter]="true"></p-listbox>
    </div>
    <div>
      <h3>{{ l.t['FILTRE_REGIONS'] }}</h3>
      <p-listbox [options]="store.listes.regions" formControlName="regions" (onChange)="filtreRegions($event)"
        [multiple]="true" [checkbox]="true" [filter]="true"></p-listbox>
    </div>
    <div>
      <h3>{{ l.t['FILTRE_PDO'] }}</h3>
      <!-- <p-listbox [options]="store.listes.pdo | types:fF.controls.type.value" formControlName="pdo" optionLabel="name" -->
      <p-listbox [options]="store.listes.pdo" formControlName="pdo"
        (onChange)="filtrePdo()" [multiple]="true" [checkbox]="true" [filter]="true">
      </p-listbox>
    </div>
    <!-- FILTERS FOR YEARS GAP -->
    <div>
      <h3>{{ l.t['FILTRE_ANNEES'] }}</h3>
      <h4>{{ l.t['FILTRE_PLAGE_REND'] }}</h4>
      <p class="ecarts">
        <span>{{ fF.controls.rendements.value }}</span>
        <p-slider formControlName="rendements" [min]="config.rendements.debut" [max]="config.rendements.fin"
          (onSlideEnd)="applyFilters($event)" class="inverse"></p-slider>
        <span>{{ config.rendements.fin }}</span>
      </p>
      <h4>{{ l.t['FILTRE_PLAGE_PREDIC'] }}</h4>
      <p class="ecarts">
        <span>{{ config.predictions.debut }}</span>
        <p-slider formControlName="predictions" [min]="config.predictions.debut" [max]="config.predictions.fin"
          (onSlideEnd)="applyFilters($event)"></p-slider>
        <span>{{ fF.controls.predictions.value }}</span>
      </p>
    </div>
  </form>
</section>
<!-- VISUALISATION -->
<section>
  <p>{{ l.t['RES_DESCR'] }}</p>
  <h2>{{ l.page.titre }}</h2>
  <p-dialog [header]="l.page.titre" [(visible)]="infos">
    <article [innerHTML]="l.page.contenu"></article>
  </p-dialog>
  <form [formGroup]="fF">
      <label>
        <p-checkbox name="predictions" formControlName="donnees" [binary]="true"></p-checkbox>
        {{ l.t['FILTRE_PREDICTIONS'] }}
      </label>
      <label>
        <p-checkbox name="moyennes" formControlName="moyennes" [binary]="true"></p-checkbox>
        {{ l.t['FILTRE_MOYENNES'] }}
      </label>
      <label>
        <p-checkbox name="croissance" formControlName="croissance" [binary]="true"></p-checkbox>
        {{ l.t['FILTRE_CROISSANCE'] }}
      </label>
  </form>
  <!-- CHART -->
  <article id="chartdata" *ngIf="fF.controls.donnees.value">
    <h3>{{ l.t['RES_VISUAL'] }}</h3>
    <h4>{{ l.t['DONNEES_D_DESCR'] }}</h4>
    <button (click)="downloadStats('chart')" class="download"><i class="pi pi-download"></i></button>
    <div>
      <p-chart [type]="chartType" [data]="DATA.RD" [options]="chartOpLeft" #chart></p-chart>
      <p-chart [type]="chartType" [data]="DATA.PR" [options]="chartOpRight" #chartPredictions></p-chart>
    </div>
    <div class="legende">
      <legend *ngFor="let d of DATA.RD.datasets">
        <span [ngStyle]="{'background-color': d.borderColor}"></span><p>{{ d.label }}</p>
      </legend>
    </div>
  </article>
  <article *ngIf="pdo.length > 0 && fF.controls.predictions.value">
    <h3>{{ l.t['FILTRE_FIABILITE'] }}</h3>
    <table>
      <thead>
        <tr>
          <th>{{ l.t['FILTRE_PAYS'] }}</th>
          <th>{{ l.t['FILTRE_REGIONS'] }}</th>
          <th>{{ l.t['FILTRE_PDO'] }}</th>
          <th *ngFor="let a of pdo[0].predictions; let i=index">{{ config.predictions.debut + i }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let d of pdo">
          <td>{{ d.pays }}</td>
          <td>{{ d.regions }}</td>
          <td>{{ d.pdo }}</td>
          <td *ngFor="let p of d.predictions">{{ p }}</td>
        </tr>
      </tbody>
    </table>
  </article>
  <article *ngIf="fF.controls.moyennes.value" class="chart">
      <h3>{{ l.t['FILTRE_MOYENNES'] }}</h3>
      <h4>{{ l.t['DONNEES_M_DESCR'] }}</h4>
      <button (click)="downloadStats('average')" class="download"><i class="pi pi-download"></i></button>
      <div>
        <p-chart [type]="chartType" [data]="DATA.RDAV" [options]="chartOpLeft" #average></p-chart>
        <!-- <p-chart [type]="chartType" [data]="DATA.PRAV" [options]="basicRight" #averagePredictions></p-chart> -->
      </div>
  </article>
  <article *ngIf="fF.controls.croissance.value" class="chart">
      <h3>{{ l.t['FILTRE_CROISSANCE'] }}</h3>
      <h4>{{ l.t['DONNEES_C_DESCR'] }}</h4>
      <button (click)="downloadStats('growth')" class="download"><i class="pi pi-download"></i></button>
      <div>
        <p-chart type="bar" [data]="DATA.RDGR" [options]="chartOpNu" #growth></p-chart>
        <!-- <p-chart type="bar" [data]="DATA.PRGR" [options]="basicRight" #growthPredictions></p-chart> -->

      </div>
  </article>
</section>
